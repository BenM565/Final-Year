<!--code layout is from chatgpt-->
<!--inside is customised with my own code-->

{% extends "base.html" %}
{% block content %}

<div class="container mt-3">
  <h4 class="mb-3">Dashboard</h4>

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <div class="row g-3">
    {# STUDENT DASHBOARD #}
    {% if user.role == 'student' %}
      <div class="col-md-6">
        <div class="card shadow-sm">
          <div class="card-body">
            <h6 class="fw-bold">
              Your profile
              {% if user.verified %}
                <span class="badge bg-success ms-2">Verified</span>
              {% endif %}
            </h6>
            <p class="mb-1"><strong>Skills:</strong> {{ user.skills or '—' }}</p>
            <p class="mb-1"><strong>Grades:</strong> {{ user.grades or '—' }}</p>
            <p class="mb-1"><strong>Projects:</strong> {{ user.projects or '—' }}</p>
            <p class="mb-0"><strong>References:</strong> {{ user.references or '—' }}</p>
          </div>
        </div>
      </div>

      <div class="col-md-6">
        <div class="card shadow-sm mb-3">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <h6 class="fw-bold mb-0">Available tasks</h6>
              <a href="{{ url_for('student_tasks') }}" class="btn btn-sm btn-outline-primary">
                View all and filter
              </a>
            </div>
            {% if tasks %}
              <ul class="list-group small">
                {% for t in tasks %}
                  <li class="list-group-item d-flex justify-content-between align-items-center">
                    <div>
                      <div class="fw-semibold">{{ t.title }}</div>
                      {% if t.estimated_hours %}
                        <div class="text-muted">Est. {{ t.estimated_hours }} hours</div>
                      {% endif %}
                    </div>
                    <form method="post" action="{{ url_for('apply', task_id=t.id) }}">
                      <button class="btn btn-sm btn-outline-success">Apply</button>
                    </form>
                  </li>
                {% endfor %}
              </ul>
            {% else %}
              <p class="text-muted mb-0">No tasks available yet.</p>
            {% endif %}
          </div>
        </div>

        <div class="card shadow-sm">
          <div class="card-body">
            <h6 class="fw-bold mb-2">Raise a dispute</h6>
            <p class="small text-muted mb-3">
              If you have an issue with a task or interaction on the platform, you can raise a dispute for the admin team to review.
            </p>
            <a href="{{ url_for('dispute_new') }}" class="btn btn-outline-danger btn-sm">
              Create dispute
            </a>
          </div>
        </div>
      </div>

    {# COMPANY DASHBOARD #}
    {% elif user.role == 'company' %}
      <div class="col-12 mb-2 d-flex justify-content-between align-items-center">
        <h6 class="fw-bold mb-0">Your posted tasks</h6>
        <a href="{{ url_for('add_task') }}" class="btn btn-sm btn-primary">
          Add task
        </a>
      </div>

      <div class="col-12">
        {% if tasks %}
          <ul class="list-group">
            {% for t in tasks %}
              <li class="list-group-item d-flex justify-content-between align-items-center">
                <div>
                  <div class="fw-semibold">{{ t.title }}</div>
                  <div class="small text-muted mb-1">
                    {{ t.requirements or 'No description provided.' }}
                  </div>
                  {% if t.estimated_hours %}
                    <div class="small text-muted">
                      Estimated hours: {{ t.estimated_hours }}
                    </div>
                  {% endif %}
                </div>
                <div class="text-end">
                  <div class="small mb-1">
                    Applications: {{ counts.get(t.id, 0) }}
                  </div>
                  <a href="{{ url_for('edit_task', task_id=t.id) }}" class="btn btn-sm btn-outline-secondary mb-1">
                    Edit
                  </a>
                  <form method="post"
                        action="{{ url_for('delete_task', task_id=t.id) }}"
                        class="d-inline"
                        onsubmit="return confirm('Delete this task?');">
                    <button class="btn btn-sm btn-outline-danger">Delete</button>
                  </form>
                </div>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <p class="text-muted">You have not created any tasks yet.</p>
        {% endif %}
      </div>

    {# ADMIN DASHBOARD ENTRY #}
    {% elif user.role == 'admin' %}
      <div class="col-12">
        <p class="mb-2">You are logged in as an administrator.</p>
        <a href="{{ url_for('admin_home') }}" class="btn btn-primary btn-sm">
          Go to admin dashboard
        </a>
      </div>
    {% endif %}
  </div>
</div>

{% endblock %}
